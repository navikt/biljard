---
import Layout from '../../layouts/Layout.astro';
import { getAllTournaments } from '../../lib/db';
import { Button } from '@/components/ui/button';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { Card, CardHeader, CardContent, CardTitle, CardDescription } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';

const tournaments = getAllTournaments();
---

<Layout title="Admin - Biljardturnering">
  <div class="mb-8">
    <h1 class="text-4xl font-bold mb-2">Administrasjon</h1>
    <p class="text-lg text-muted-foreground">Administrer turneringer, deltakere og resultater</p>
  </div>

  <div class="mb-8">
    <a href="/admin/ny-turnering">
      <Button>+ Opprett ny turnering</Button>
    </a>
  </div>

  <section className="mt-6">
    <h2 class="text-2xl font-bold mb-4">Turneringer</h2>
    
    {tournaments.length > 0 ? (
      <div class="grid gap-4">
        {tournaments.map((tournament) => (
          <Card>
            <CardHeader className="pb-2">
              <div class="flex justify-between items-start gap-4 flex-wrap">
                <div class="flex items-center gap-3 flex-wrap">
                  <CardTitle>{tournament.name}</CardTitle>
                  <Badge variant={
                    tournament.status === 'registration' ? 'default' : 
                    tournament.status === 'active' ? 'secondary' : 'outline'
                  }>
                    {tournament.status === 'registration' ? 'PÃ¥melding' : 
                     tournament.status === 'active' ? 'PÃ¥gÃ¥r' : 'Avsluttet'}
                  </Badge>
                </div>
                <div class="flex gap-2">
                  <a href={`/admin/turnering/${tournament.id}`}>
                    <Button variant="outline" size="sm">Administrer</Button>
                  </a>
                  <a href={`/turnering/${tournament.id}`}>
                    <Button variant="ghost" size="sm">Se turnering</Button>
                  </a>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              <div class="flex gap-4 text-sm text-muted-foreground flex-wrap">
                <span>ğŸ“… {tournament.rounds} runder</span>
                <span>â±ï¸ {tournament.round_duration_weeks} uker/runde</span>
                {tournament.registration_deadline && (
                  <span>ğŸ—“ï¸ Frist: {new Date(tournament.registration_deadline).toLocaleDateString('nb-NO')}</span>
                )}
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
    ) : (
      <Alert>
        <AlertDescription>
          Ingen turneringer opprettet ennÃ¥. Klikk "Opprett ny turnering" for Ã¥ komme i gang.
        </AlertDescription>
      </Alert>
    )}
  </section>
</Layout>
