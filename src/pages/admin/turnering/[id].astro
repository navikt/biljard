---
import Layout from '../../../layouts/Layout.astro';
import { getTournamentById, getParticipantsByTournament, getMatchesByTournament, getStandings } from '../../../lib/db';
import TournamentAdmin from '../../../components/TournamentAdmin.astro';
import { Badge } from '@/components/ui/badge';

const { id } = Astro.params;
const tournamentId = parseInt(id || '0');
const tournament = getTournamentById(tournamentId);

if (!tournament) {
  return Astro.redirect('/admin');
}

const participants = getParticipantsByTournament(tournamentId);
const matches = getMatchesByTournament(tournamentId);
const standings = getStandings(tournamentId);
---

<Layout title={`Admin: ${tournament.name}`}>
  <div class="flex items-center gap-4 flex-wrap mb-8">
    <h1 class="text-4xl font-bold">{tournament.name}</h1>
    <Badge variant={
      tournament.status === 'registration' ? 'default' : 
      tournament.status === 'active' ? 'secondary' : 'outline'
    }>
      {tournament.status === 'registration' ? 'Påmelding' : 
       tournament.status === 'active' ? 'Pågår' : 'Avsluttet'}
    </Badge>
  </div>

  <TournamentAdmin 
    tournament={tournament}
    participants={participants}
    matches={matches}
    standings={standings}
  />
</Layout>
