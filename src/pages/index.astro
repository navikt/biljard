---
import Layout from "../layouts/Layout.astro";
import { getAllTournaments } from "../lib/db";
import { Button } from "@/components/ui/button";
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import navBiljardLogo from "../img/nav_biljard.png";

const tournaments = getAllTournaments();
const activeTournaments = tournaments.filter(
  (t) => t.status === "registration" || t.status === "active",
);
---

<Layout title="NAV Biljard">
  <div class="flex flex-col items-center justify-center py-16 md:py-28">
    <img
      src={navBiljardLogo.src}
      alt="NAV Biljard"
      class="w-56 md:w-72 mb-10"
    />
    <p
      class="text-lg text-muted-foreground max-w-md text-center leading-relaxed"
    >
      Meld deg på semesterets turnering og møt kollegaer på tvers av
      organisasjonen.
    </p>
    {
      activeTournaments.length > 0 && activeTournaments[0] && (
        <a href={`/turnering/${activeTournaments[0].id}`} class="mt-8">
          <Button size="lg">Meld deg på</Button>
        </a>
      )
    }
  </div>

  {
    activeTournaments.length > 0 && (
      <section class="mb-20">
        <h2 class="text-xl font-semibold mb-5">Aktive turneringer</h2>
        <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
          {activeTournaments.map((tournament) => (
            <a href={`/turnering/${tournament.id}`} class="block group">
              <Card class="h-full transition-all group-hover:shadow-md group-hover:border-foreground/20">
                <CardHeader>
                  <div class="flex justify-between items-start gap-2">
                    <CardTitle class="text-lg">{tournament.name}</CardTitle>
                    <Badge
                      variant={
                        tournament.status === "registration"
                          ? "default"
                          : "secondary"
                      }
                    >
                      {tournament.status === "registration" ? "Åpen" : "Pågår"}
                    </Badge>
                  </div>
                  {tournament.description && (
                    <p class="text-sm text-muted-foreground mt-2">
                      {tournament.description}
                    </p>
                  )}
                  {tournament.registration_deadline &&
                    tournament.status === "registration" && (
                      <p class="text-sm text-muted-foreground mt-2">
                        Frist:{" "}
                        {new Date(
                          tournament.registration_deadline,
                        ).toLocaleDateString("nb-NO")}
                      </p>
                    )}
                </CardHeader>
              </Card>
            </a>
          ))}
        </div>
      </section>
    )
  }

  <section class="mb-20">
    <h2 class="text-xl font-semibold mb-5">Slik fungerer det</h2>
    <div
      class="grid md:grid-cols-3 border rounded-xl overflow-hidden md:divide-x divide-y md:divide-y-0 divide-border"
    >
      <div class="p-8">
        <span
          class="text-xs font-medium uppercase tracking-widest text-muted-foreground"
          >01</span
        >
        <h3 class="font-semibold mt-3 mb-1">Meld deg på</h3>
        <p class="text-sm text-muted-foreground">
          Registrer deg på en aktiv turnering før fristen.
        </p>
      </div>
      <div class="p-8">
        <span
          class="text-xs font-medium uppercase tracking-widest text-muted-foreground"
          >02</span
        >
        <h3 class="font-semibold mt-3 mb-1">Spill kampene</h3>
        <p class="text-sm text-muted-foreground">
          Avtal tid og sted med motstanderne dine.
        </p>
      </div>
      <div class="p-8">
        <span
          class="text-xs font-medium uppercase tracking-widest text-muted-foreground"
          >03</span
        >
        <h3 class="font-semibold mt-3 mb-1">Følg resultater</h3>
        <p class="text-sm text-muted-foreground">
          Se stillingen og følg med underveis.
        </p>
      </div>
    </div>
  </section>

  <section class="text-center pb-12">
    <p class="text-muted-foreground">
      Bli med i <span class="font-medium text-foreground">#biljard</span> på Slack
      for oppdateringer.
    </p>
  </section>
</Layout>
